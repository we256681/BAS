<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Scheduler</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scheduler</title>
    <script src="js/jquery.min.js"></script>
    <script src="https://bablosoft.com/buildinterface/interface-generator/generate.js?v=5"></script>
    <script src="https://bablosoft.com/buildinterface/CodeEditor/codeeditor.js?v=4"></script>
   	
   	<style>
   		#Menu1Button
   		{
   			line-height: 16px !important;
   		}
   	</style>
	<script>

		async function UpdateHtml(GeneratedData)
		{
			var Html = ""				
			GeneratedData.cssFiles.forEach(function(file){
				Html += `<link rel="stylesheet" type="text\/css" href="${file}">`
			})
			$("head").append(Html)

			Html = `<style>${GeneratedData.css}\<\/style\>`
			$("head").append(Html)

			for(var i = 0;i<GeneratedData.jsFiles.length;i++)
			{
				var file = GeneratedData.jsFiles[i]
				file = file.replace("bas-api-testing.js","bas-api-autogenerated.js")
				file = file.replace("bas-api.js","bas-api-autogenerated.js")
				var script = document.createElement('script')
      			script.type = 'text/javascript'
			    script.src = file

      			var el = document.getElementsByTagName('head')[0]
      			el.appendChild(script)

      			await new Promise((resolve, reject) => {
	      			script.addEventListener('load', () => {
						resolve()
					})
					script.addEventListener('error', () => {
						resolve()
					})
	      		})

			}

			Html = `<script>${GeneratedData.javascript}\<\/script\>`
			$("head").append(Html)

			Html = GeneratedData.html
			$("body").prepend(Html)

		}

		function ReceiveMessage(event)
		{
			var Data = JSON.parse(event.data)
			if(Data.message == "init")
			{
				window.apiendpoint = Data.apiendpoint
				window.ResourcesDefault = Data.resources
				var Generator = new InterfaceGenerator()
				var GeneratedMain;
				if(Data.data)
					GeneratedMain = Generator.Generate(Data.data)
				else
					GeneratedMain = Data.data_generated
				UpdateHtml(GeneratedMain)
			}
		}
		
		window.addEventListener("message", ReceiveMessage, false);
		var SendData = {message: "inputdatagenerated"}
        window.parent.postMessage(JSON.stringify(SendData), "*")

	</script>
  </head>
  <body>
  	
	
  	
  </body>
</html>